driver:
  id: "bank.home-loan-takeout"
  version: "1.0.0"
  title: "Bank Home Loan Take-Out"
  description: "Evidence envelope for developer-originated home-loan take-out with bank-grade KYC"
  domain: "housing_finance"
  issuer_type: "developer"

payload:
  schema:
    id: "bank.home_loan_takeout.v1"
    format: "json_schema"
    uri: "schemas/takeout.v1.schema.json"
  storage:
    mode: "versioned"
    patch_strategy: "merge"

documents:
  registry:
    - type: "BORROWER_ID_FRONT"
      title: "Borrower ID (Front)"
      allowed_mimes: ["image/jpeg", "image/png", "application/pdf"]
      max_size_mb: 10
      multiple: false
    - type: "BORROWER_ID_BACK"
      title: "Borrower ID (Back)"
      allowed_mimes: ["image/jpeg", "image/png", "application/pdf"]
      max_size_mb: 10
      multiple: false
    - type: "PROOF_OF_INCOME"
      title: "Proof of Income / Employment"
      allowed_mimes: ["application/pdf", "image/jpeg", "image/png"]
      max_size_mb: 15
      multiple: true
    - type: "TITLE_TCT"
      title: "Property Title (TCT/CCT)"
      allowed_mimes: ["application/pdf", "image/jpeg", "image/png"]
      max_size_mb: 20
      multiple: false

checklist:
  template:
    - key: "borrower_name"
      label: "Borrower name captured"
      kind: "payload_field"
      payload_pointer: "/borrower/full_name"
      required: true
      review: "none"
    - key: "tcp_declared"
      label: "Total Contract Price declared"
      kind: "payload_field"
      payload_pointer: "/loan/tcp"
      required: true
      review: "none"
    - key: "borrower_id_front"
      label: "Borrower ID (Front) uploaded"
      kind: "document"
      doc_type: "BORROWER_ID_FRONT"
      required: true
      review: "required"
    - key: "title_tct"
      label: "Property title uploaded"
      kind: "document"
      doc_type: "TITLE_TCT"
      required: true
      review: "required"
    - key: "kyc_passed_signal"
      label: "Bank-grade KYC passed"
      kind: "signal"
      signal_key: "kyc_passed"
      required: true
      review: "none"
    - key: "account_created_signal"
      label: "Borrower bank account created"
      kind: "signal"
      signal_key: "account_created"
      required: true
      review: "none"
    - key: "underwriting_approved_signal"
      label: "Underwriting approved"
      kind: "signal"
      signal_key: "underwriting_approved"
      required: true
      review: "none"

signals:
  definitions:
    - key: "kyc_passed"
      type: "boolean"
      source: "host"
      default: false
    - key: "account_created"
      type: "boolean"
      source: "host"
      default: false
    - key: "underwriting_approved"
      type: "boolean"
      source: "host"
      default: false

gates:
  definitions:
    - key: "payload_valid"
      rule: "payload.valid == true"
    - key: "checklist_complete"
      rule: "checklist.required_accepted == true"
    - key: "evidence_ready"
      rule: "gate.payload_valid && gate.checklist_complete"
    - key: "account_ready"
      rule: "signal.kyc_passed && signal.account_created"
    - key: "settleable"
      rule: "gate.evidence_ready && gate.account_ready && signal.underwriting_approved"

audit:
  enabled: true
  capture:
    - "payload_patch"
    - "attachment_upload"
    - "attachment_review"
    - "signal_set"
    - "gate_change"
    - "status_change"

manifest:
  enabled: true
  includes:
    payload_hash: true
    attachments_hashes: true
    envelope_fingerprint: true

ui:
  display:
    title_field: "/borrower/full_name"
    subtitle_field: "/loan/tcp"
  steps:
    - "borrower_consent"
    - "kyc"
    - "attachments"
    - "review"
