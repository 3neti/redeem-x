# Voucher Redemption Driver
# Transforms VoucherInstructionsData â†’ FormFlowInstructionsData

driver:
  name: "voucher-redemption"
  version: "1.0"
  source: "LBHurtado\\Voucher\\Data\\VoucherInstructionsData"
  target: "LBHurtado\\FormFlowManager\\Data\\FormFlowInstructionsData"

# Required mappings (even if empty, required by DriverConfigData)
mappings: {}

# Reference ID template
reference_id: "disburse-{{ code }}-{{ timestamp }}"

# Callback URLs
callbacks:
  on_complete: "{{ base_url }}/disburse/{{ code }}/complete"
  on_cancel: "{{ base_url }}/disburse"

# Step definitions
steps:
  # Step 1: Wallet information (always first)
  wallet:
    handler: "form"
    title: "Wallet Information"
    description: "Redeeming voucher {{ code }} - {{ amount | format_money }} from {{ owner_name }}"
    fields:
      - name: "amount"
        type: "number"
        label: "Amount"
        readonly: true
        required: true
      - name: "settlement_rail"
        type: "settlement_rail"
        label: "Payment Method"
        required: true
      - name: "mobile"
        type: "text"
        label: "Mobile Number"
        placeholder: "+639171234567"
        required: true
      - name: "recipient_country"
        type: "recipient_country"
        label: "Country"
        readonly: true
        required: true
      - name: "bank_code"
        type: "bank_account"
        label: "Bank/EMI"
        required: true
      - name: "account_number"
        type: "text"
        label: "Account Number"
        placeholder: "1234567890"
        required: true
  
  # Step 2: Personal Information (bio fields)
  bio:
    handler: "form"
    title: "Personal Information"
    description: "Please provide your details"
    condition: "{{ has_name or has_email or has_birth_date or has_address }}"
    fields:
      - name: "name"
        type: "text"
        label: "Full Name"
        required: true
        condition: "{{ has_name }}"
      - name: "email"
        type: "email"
        label: "Email Address"
        required: true
        condition: "{{ has_email }}"
      - name: "birth_date"
        type: "date"
        label: "Birth Date"
        required: true
        condition: "{{ has_birth_date }}"
      - name: "address"
        type: "textarea"
        label: "Address"
        required: false
        condition: "{{ has_address }}"
  
  # Step 3: Location capture
  location:
    handler: "location"
    title: "Share Your Location"
    description: "We need your current location for verification"
    condition: "{{ has_location }}"
    config:
      require_address: true
      capture_snapshot: true
  
  # Step 4: Selfie capture
  selfie:
    handler: "selfie"
    title: "Take a Selfie"
    description: "Please take a clear selfie for verification"
    condition: "{{ has_selfie }}"
    config:
      width: 640
      height: 480
      quality: 0.9
  
  # Step 5: Signature capture
  signature:
    handler: "signature"
    title: "Digital Signature"
    description: "Please provide your digital signature"
    condition: "{{ has_signature }}"
    config:
      width: 600
      height: 256
      quality: 0.85
      line_width: 2
  
  # Step 6: KYC verification
  kyc:
    handler: "kyc"
    title: "Identity Verification"
    description: "Complete identity verification to proceed"
    condition: "{{ has_kyc }}"
